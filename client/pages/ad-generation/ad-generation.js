import {Template} from 'meteor/templating';

Template.form.events({
    'click .js-generate': function (e, template) {

        const tplCount = SelectedAdTemplate.find().count();
        const dataCount = SelectedAdData.find().count();
        let msg = 'No selected ';
        let selected = true;
        if (tplCount == 0 && dataCount == 0) {
            msg += 'Template and Data';
            selected = false;
        } else if (tplCount == 0 && dataCount != 0) {
            msg += 'Template';
            selected = false;
        } else if (tplCount != 0 && dataCount == 0) {
            msg += 'Data';
            selected = false;
        }
        if (!selected) {
            sAlert.warning(msg)
            return;
        }
        UIBlock.block('Generating...');
        Meteor.call('generateAd', {
            adTemplateId: SelectedAdTemplate.find().fetch()[0].adTemplateId,
            adDataId: SelectedAdData.find().fetch()[0].adDataId
        }, function (err, res) {
            if (err) {
                console.log(err);
                if (err.error === 'duplicated-generation') {
                    sAlert.warning('<strong> Ad </strong> has been already generated by this <strong>Template</strong> and <strong>Data</strong>');
                } else {
                    sAlert.error('<strong> Ad </strong> has not been generated, Try again!');
                }
            } else {
                sAlert.success('Ad has been generated');
                SelectedAdTemplate.remove();
                SelectedAdData.remove();
            }
            UIBlock.unblock();
        });
    }
})
;